# 快速参考

## 🔖 常用代码片段和速查表

本文档提供迁移过程中常用的代码片段和对照表，方便快速查阅。

---

## 1️⃣ Canvas vs Cocos 对照表

### 坐标系统

| 操作 | HTML5 Canvas | Cocos Creator |
|------|-------------|---------------|
| **原点位置** | 左上角 (0, 0) | 中心点（可配置锚点） |
| **Y轴方向** | 向下为正 | 向上为正（可配置） |
| **设置位置** | 手动绘制 x, y | `node.setPosition(x, y)` |
| **获取位置** | 变量存储 | `node.position` |
| **世界坐标** | 手动计算 | `node.getWorldPosition()` |

### 渲染对比

| 操作 | HTML5 Canvas | Cocos Creator |
|------|-------------|---------------|
| **绘制矩形** | `ctx.fillRect(x, y, w, h)` | `Sprite` 组件 |
| **绘制文字** | `ctx.fillText(text, x, y)` | `Label` 组件 |
| **绘制图片** | `ctx.drawImage(img, x, y)` | `Sprite` + SpriteFrame |
| **清空画布** | `ctx.clearRect()` | 引擎自动处理 |
| **设置颜色** | `ctx.fillStyle = 'red'` | `sprite.color = Color.RED` |
| **设置透明度** | `ctx.globalAlpha = 0.5` | `node.opacity = 128` |

### 事件监听

| 事件类型 | HTML5 | Cocos Creator |
|---------|-------|---------------|
| **键盘** | `addEventListener('keydown')` | `systemEvent.on(KEY_DOWN)` |
| **鼠标** | `addEventListener('click')` | `node.on(TOUCH_START)` |
| **触摸** | `addEventListener('touchstart')` | `node.on(TOUCH_START)` |
| **自定义** | `dispatchEvent()` | `node.emit('event-name')` |

---

## 2️⃣ 常用 Cocos API

### 节点操作

```typescript
// 创建节点
const node = new Node('NodeName');

// 添加子节点
parent.addChild(node);

// 移除节点
node.removeFromParent();
node.destroy();

// 查找节点
const child = node.getChildByName('ChildName');
const component = node.getComponent(ComponentName);

// 位置操作
node.setPosition(x, y, z);
node.setWorldPosition(worldPos);
const pos = node.position;

// 旋转和缩放
node.setRotationFromEuler(0, 0, 45);
node.setScale(2, 2, 1);

// 显示/隐藏
node.active = false;
```

### 组件操作

```typescript
// 添加组件
const sprite = node.addComponent(Sprite);

// 获取组件
const label = node.getComponent(Label);

// 移除组件
node.removeComponent(Sprite);

// 启用/禁用组件
component.enabled = false;
```

### 资源加载

```typescript
// 加载单个资源
resources.load('path/to/asset', AssetType, (err, asset) => {
    if (!err) {
        // 使用资源
    }
});

// 加载多个资源
resources.loadDir('path/to/dir', (err, assets) => {
    // ...
});

// 释放资源
resources.release('path/to/asset');

// 预加载
resources.preload('path/to/asset', AssetType);
```

### 动画

```typescript
// 使用 Tween 动画
tween(node)
    .to(1, { position: new Vec3(100, 100, 0) })
    .to(0.5, { scale: new Vec3(1.5, 1.5, 1) })
    .start();

// 链式调用
tween(node)
    .by(1, { position: new Vec3(0, 100, 0) })
    .delay(0.5)
    .to(1, { opacity: 0 })
    .call(() => {
        node.destroy();
    })
    .start();
```

---

## 3️⃣ 类型定义模板

### 单词数据

```typescript
export interface WordData {
    word: string;
    phonetic: string;
    meaning: string;
    difficulty: number;
    missingIndices: number[];
    stressPositions: number[];
}
```

### 游戏配置

```typescript
export interface GameConfig {
    canvasWidth: number;
    canvasHeight: number;
    baseFallSpeed: number;
    speedIncrement: number;
}
```

### 组件基类模板

```typescript
import { _decorator, Component, Node } from 'cc';
const { ccclass, property } = _decorator;

@ccclass('ClassName')
export class ClassName extends Component {
    @property(Node)
    targetNode: Node = null;
    
    protected onLoad(): void {
        // 组件加载完成
    }
    
    protected start(): void {
        // 首帧之前
    }
    
    protected update(deltaTime: number): void {
        // 每帧更新
    }
    
    protected onDestroy(): void {
        // 组件销毁时清理
    }
}
```

---

## 4️⃣ 常用工具函数

### 随机数

```typescript
// 范围随机数
function randomRange(min: number, max: number): number {
    return Math.random() * (max - min) + min;
}

// 随机整数
function randomInt(min: number, max: number): number {
    return Math.floor(randomRange(min, max + 1));
}

// 随机选择
function randomChoice<T>(array: T[]): T {
    return array[Math.floor(Math.random() * array.length)];
}
```

### 向量计算

```typescript
import { Vec2, Vec3, math } from 'cc';

// 距离计算
const distance = Vec3.distance(pos1, pos2);

// 角度转弧度
const radian = math.toRadian(45);

// 弧度转角度
const degree = math.toDegree(Math.PI / 4);

// 向量插值
const result = new Vec3();
Vec3.lerp(result, start, end, 0.5);
```

### 定时器

```typescript
// 延迟执行
this.scheduleOnce(() => {
    // 执行代码
}, 2.0); // 2秒后执行

// 重复执行
this.schedule(() => {
    // 每隔1秒执行
}, 1.0);

// 取消定时器
this.unschedule(callback);
this.unscheduleAllCallbacks();
```

---

## 5️⃣ 调试技巧

### 日志输出

```typescript
// 普通日志
console.log('信息');

// 警告
console.warn('警告');

// 错误
console.error('错误');

// 带样式的日志
console.log('%c重要信息', 'color: red; font-size: 20px');
```

### 性能监控

```typescript
// 开始计时
console.time('操作名称');

// 执行操作
// ...

// 结束计时
console.timeEnd('操作名称');
```

### 断点调试

```typescript
// 设置断点
debugger;

// 条件断点
if (someCondition) {
    debugger;
}
```

---

## 6️⃣ 性能优化技巧

### 对象池

```typescript
import { NodePool, instantiate } from 'cc';

private bulletPool: NodePool = new NodePool();

// 获取对象
getBullet(): Node {
    let bullet = this.bulletPool.size() > 0 
        ? this.bulletPool.get() 
        : instantiate(this.bulletPrefab);
    return bullet;
}

// 回收对象
recycleBullet(bullet: Node): void {
    this.bulletPool.put(bullet);
}
```

### 批量操作

```typescript
// 使用批量更新减少性能开销
const nodes: Node[] = [];
for (let i = 0; i < 100; i++) {
    const node = instantiate(prefab);
    nodes.push(node);
}
// 一次性添加
nodes.forEach(node => parent.addChild(node));
```

### 避免频繁创建

```typescript
// ❌ 不好的做法
update(dt: number) {
    const pos = new Vec3(x, y, 0); // 每帧创建新对象
    node.setPosition(pos);
}

// ✅ 好的做法
private tempPos: Vec3 = new Vec3();

update(dt: number) {
    this.tempPos.set(x, y, 0); // 复用对象
    node.setPosition(this.tempPos);
}
```

---

## 7️⃣ 快捷键

### Cocos Creator 编辑器

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + S` | 保存场景 |
| `Ctrl + P` | 预览游戏 |
| `Ctrl + Shift + B` | 构建项目 |
| `Ctrl + D` | 复制节点 |
| `Delete` | 删除节点 |
| `Ctrl + Z` | 撤销 |
| `Ctrl + Y` | 重做 |
| `F2` | 重命名 |

### Chrome 开发者工具

| 快捷键 | 功能 |
|--------|------|
| `F12` | 打开开发者工具 |
| `Ctrl + Shift + C` | 检查元素 |
| `Ctrl + Shift + J` | 打开控制台 |
| `F5` | 刷新页面 |
| `Ctrl + F5` | 强制刷新 |

---

## 8️⃣ 常见错误及解决

### 错误 1：节点未找到

```typescript
// ❌ 错误
const node = find('NodeName');
node.active = false; // 可能报错：Cannot read property 'active' of null

// ✅ 正确
const node = find('NodeName');
if (node) {
    node.active = false;
}
```

### 错误 2：资源加载失败

```typescript
// ✅ 始终检查错误
resources.load('path', Type, (err, asset) => {
    if (err) {
        console.error('加载失败:', err);
        return;
    }
    // 使用资源
});
```

### 错误 3：组件未挂载

```typescript
// ❌ 假设组件存在
const component = node.getComponent(MyComponent);
component.doSomething(); // 可能报错

// ✅ 检查组件
const component = node.getComponent(MyComponent);
if (component) {
    component.doSomething();
}
```

---

## 9️⃣ Git 命令速查

```bash
# 查看状态
git status

# 添加文件
git add .
git add filename

# 提交
git commit -m "提交信息"

# 推送
git push origin main

# 拉取
git pull origin main

# 创建分支
git checkout -b branch-name

# 切换分支
git checkout branch-name

# 查看日志
git log --oneline
```

---

## 🔟 有用的网站

- [Cocos Creator API 文档](https://docs.cocos.com/creator/3.8/api/zh/)
- [TypeScript 手册](https://www.typescriptlang.org/docs/handbook/intro.html)
- [MDN Web Docs](https://developer.mozilla.org/)
- [Stack Overflow](https://stackoverflow.com/)
- [Cocos 论坛](https://forum.cocos.org/)

---

**快速参考完成！** 🎯

返回：[文档目录](./README.md)




