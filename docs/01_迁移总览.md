# Word Tetris 项目迁移指南

## 📋 文档概述

本系列文档详细说明如何将 HTML5 Canvas 版本的 Word Tetris 游戏迁移到 Cocos Creator 平台。

---

## 📚 文档索引

1. **01_迁移总览.md**（本文档）- 项目概况和迁移路线图
2. **02_环境准备.md** - Cocos Creator 安装和项目初始化
3. **03_项目结构设计.md** - Cocos 项目的目录组织和场景设计
4. **04_资源迁移指南.md** - 单词库、音频、图片等资源的迁移
5. **05_核心逻辑迁移.md** - 游戏核心代码的 Cocos 化改造
6. **06_渲染系统改造.md** - Canvas 2D 到 Cocos 节点系统的转换
7. **07_UI系统重建.md** - 使用 Cocos UI 组件重建界面
8. **08_音频系统适配.md** - TTS 和音频系统的平台适配
9. **09_测试验证清单.md** - 功能测试和性能优化指南
10. **10_常见问题FAQ.md** - 迁移过程中的常见问题和解决方案

---

## 🎯 迁移目标

### 原始版本（proj/）
- **平台**：HTML5 + Canvas 2D
- **语言**：纯 JavaScript（ES6+）
- **渲染**：Canvas 2D API
- **部署**：Web（Vercel/Gitee Pages）

### 目标版本（proj-cocos/）
- **平台**：Cocos Creator 3.8.x
- **语言**：TypeScript（推荐）或 JavaScript
- **渲染**：Cocos 节点系统 + Sprite
- **部署**：Web + iOS + Android（跨平台）

---

## 🎮 游戏功能清单

根据 `word_tetris_game_design.md` 设计文档，需要迁移的核心功能包括：

### ✅ 核心游戏机制
- [x] 单词顺序下降系统
- [x] 缓冲区倒计时（红黄绿信号灯）
- [x] 字母缺失和实时输入验证
- [x] 炮管自动瞄准和射击系统
- [x] 错误标记（血色红叉）
- [x] 爆炸粒子效果
- [x] 中文翻译爆炸动画
- [x] 堆叠区管理
- [x] 分数和等级系统

### ✅ 视觉效果
- [x] 炮管系统（5层结构：基座+平台+炮管+炮口+引信）
- [x] 燃烧引信物理摆动
- [x] 火球炮弹（三层结构+火焰尾迹）
- [x] 后坐力系统
- [x] 多彩粒子爆炸
- [x] 单词图片展示区（200x200px）
- [x] 实时输入高亮
- [x] 重音音节红色高亮

### ✅ 音频系统
- [x] TTS 语音朗读（多提供商降级）
- [x] iOS 设备优化（Web Speech API）
- [x] 音频缓存系统（IndexedDB + 本地文件）
- [x] 游戏模式差异化播放（休闲模式 vs 挑战模式）

### ✅ 词库系统
- [x] 三级层级化词库（按天学习/专项练习/按年级）
- [x] 分布式单词库架构
- [x] 可视化词库设置界面
- [x] 单词级别互斥原则

### ✅ UI 和交互
- [x] 三栏布局（图片展示区+游戏画布+侧边栏）
- [x] 游戏模式切换（休闲/挑战）
- [x] 生词本管理
- [x] 考试统计系统
- [x] 调试日志面板

---

## 🗺️ 迁移路线图

### 第一阶段：基础搭建（1-2天）
- [x] ✅ Cocos Creator 项目创建
- [ ] 🔄 项目结构设计
- [ ] 🔄 资源目录规划
- [ ] 🔄 场景和预制体创建

### 第二阶段：核心功能（3-5天）
- [ ] 🔄 单词管理系统迁移
- [ ] 🔄 游戏主循环改造
- [ ] 🔄 输入系统实现
- [ ] 🔄 射击和碰撞检测

### 第三阶段：视觉效果（2-3天）
- [ ] 🔄 炮管系统重建
- [ ] 🔄 粒子效果实现
- [ ] 🔄 动画和特效
- [ ] 🔄 UI 界面搭建

### 第四阶段：音频和优化（2-3天）
- [ ] 🔄 TTS 系统适配
- [ ] 🔄 音频缓存实现
- [ ] 🔄 性能优化
- [ ] 🔄 移动端适配

### 第五阶段：测试和发布（1-2天）
- [ ] 🔄 功能完整性测试
- [ ] 🔄 跨平台测试
- [ ] 🔄 打包和发布

**预计总工期：9-15天**

---

## 📊 技术对比表

| 功能模块 | HTML5 Canvas 实现 | Cocos Creator 实现 | 难度 |
|---------|------------------|-------------------|------|
| **游戏循环** | `requestAnimationFrame` | `update(dt)` 生命周期 | ⭐ 简单 |
| **渲染** | Canvas 2D API | Sprite + Node | ⭐⭐ 中等 |
| **输入** | `addEventListener('keydown')` | `cc.systemEvent` / EditBox | ⭐ 简单 |
| **音频** | `Audio` 对象 | `cc.audioEngine` | ⭐⭐ 中等 |
| **TTS** | Web Speech API + 第三方 API | 保持原有实现 | ⭐ 简单 |
| **粒子** | Canvas 手绘 | `cc.ParticleSystem2D` | ⭐⭐⭐ 较难 |
| **动画** | 手动插值 | `cc.tween` / Animation | ⭐⭐ 中等 |
| **UI** | HTML DOM | Cocos UI 组件 | ⭐⭐⭐ 较难 |
| **数据** | localStorage | `cc.sys.localStorage` | ⭐ 简单 |
| **资源** | 直接加载 | `cc.resources.load` | ⭐⭐ 中等 |

---

## 🔑 关键技术要点

### 1. 坐标系转换
```javascript
// Canvas: 左上角为原点，Y轴向下
// Cocos: 中心点为锚点，Y轴向上（可配置）

// Canvas 代码
ctx.fillRect(100, 200, 50, 50);

// Cocos 代码（需要坐标转换）
node.setPosition(100 + 25, canvasHeight - 200 - 25);
node.setContentSize(50, 50);
```

### 2. 组件化开发
```typescript
// Cocos 使用组件系统
import { _decorator, Component, Node } from 'cc';
const { ccclass, property } = _decorator;

@ccclass('GameManager')
export class GameManager extends Component {
    @property(Node)
    cannon: Node = null;
    
    update(deltaTime: number) {
        // 每帧更新逻辑
    }
}
```

### 3. 资源加载
```typescript
// 动态加载单词库
cc.resources.load('words/day01', JsonAsset, (err, asset) => {
    if (!err) {
        const words = asset.json;
        // 使用单词数据
    }
});
```

### 4. 事件系统
```typescript
// Cocos 事件监听
this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);

// 全局键盘监听
systemEvent.on(SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
```

---

## 🎨 设计文档参考

迁移过程中需要严格遵循原设计文档 `word_tetris_game_design.md` 的所有要求：

- ✅ 所有视觉效果必须 100% 实现
- ✅ 所有动画效果必须符合设计
- ✅ 所有游戏机制必须准确还原
- ✅ 音频系统必须保持多提供商降级机制
- ✅ 词库系统必须保持三级层级结构

**设计文档是法律，不是参考！每一个细节都必须实现！**

---

## 📖 推荐阅读顺序

1. **先读完本文档**，了解整体迁移思路
2. **阅读 02_环境准备.md**，配置开发环境
3. **阅读 03_项目结构设计.md**，理解 Cocos 项目组织
4. **按顺序阅读 04-08 号文档**，逐步完成迁移
5. **使用 09_测试验证清单.md** 验证功能
6. **遇到问题查阅 10_常见问题FAQ.md**

---

## ⚠️ 重要提醒

### 必须保持的功能
- ✅ 所有设计文档中的视觉效果
- ✅ TTS 多提供商降级机制
- ✅ 音频缓存系统（适配 Cocos）
- ✅ 三级层级化词库系统
- ✅ 游戏模式切换（休闲/挑战）
- ✅ 单词图片展示系统
- ✅ 调试日志系统

### 可以优化的部分
- ⭐ 使用 Cocos 粒子系统替代手绘粒子
- ⭐ 使用 Cocos 动画系统简化动画实现
- ⭐ 使用对象池优化性能
- ⭐ 使用 Cocos UI 组件简化界面开发

### 禁止简化的部分
- ❌ 炮管五层结构（不能简化为简单图片）
- ❌ 燃烧引信物理摆动（不能用静态动画替代）
- ❌ 中文翻译爆炸动画（必须实现放大效果）
- ❌ 重音音节红色高亮（必须保留）
- ❌ 错误标记血色红叉（必须保留）

---

## 📝 版本信息

- **原始版本**：proj/ (HTML5 Canvas)
- **目标版本**：proj-cocos/ (Cocos Creator 3.8.x)
- **文档版本**：v1.0
- **创建日期**：2025-10-22
- **最后更新**：2025-10-22

---

## 🔗 相关资源

- [Cocos Creator 官方文档](https://docs.cocos.com/creator/manual/zh/)
- [TypeScript 文档](https://www.typescriptlang.org/docs/)
- [原始设计文档](../../word_tetris_game_design.md)
- [原始项目代码](../../proj/)

---

**准备好了吗？让我们开始迁移之旅！** 🚀

下一步：阅读 [02_环境准备.md](./02_环境准备.md)




